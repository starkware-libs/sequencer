# Local Monitoring Stack

### Requirements:
- Python3
- docker >= 27.3.1 - (installation guide https://docs.docker.com/engine/install/ubuntu/)

## need to run the first 2 commands.
### Setup:
```bash
python3 -m venv monitoring_venv
source monitoring_venv/bin/activate
docker create local_data
## docker volume create local_data
```
## where is my persistent storage + how to make it zero.
## pinpoint on the function- 30 vs 300ms.
## find the flush log in the memory- maybe add more verbose logs.
## maybe add a script to monitor th elogs.
## start with the function- make it optimized in my setup and then figure out how to optiomize it in the real setup.
### Start up:
To run with docker cache:
```bash
./deployments/monitoring/deploy_local_stack.sh up -d
```
## need to run this command to automatically sync a node.
To force build (useful to enforce applying changes in docker file settings):
```bash
./deployments/monitoring/deploy_local_stack.sh up -d --build
```

## This will deploy a local stack of:
- Sequencer Node Setup
- Sequencer Node (using a config generated by **Sequencer Node Setup**.)
- Sequencer Node Simulator
- Dummy Cende Recorder
- Prometheus
- Grafana (Using: [dev_grafana.json](../../crates/apollo_dashboard/resources/dev_grafana.json) dashboard.)

Once the node starts emitting logs, one can ctrl+c to move the run to the background.

## Open Grafana:
After Grafana starts running, it can be viewed by accessing http://localhost:3000 in a web browser.

## Troubleshooting
If encountering `Failed to deploy the monitoring stack locally`, verify the docker version is adequate:
```
docker --version
docker compose --version
```

## Shutdown & Cleanup:
```bash
./deployments/monitoring/deploy_local_stack.sh down -v
deactivate
rm -rf monitoring_venv
docker rm local_data
```
## Making changes:
After making changes, update dev_grafana.json by running:
```bash
cargo run --bin sequencer_dashboard_generator
```
