apiVersion: batch/v1
kind: Job
metadata:
  name: verify-clean-disk
  namespace: dean-batching
spec:
  backoffLimit: 0
  template:
    spec:
      restartPolicy: Never
      nodeSelector:
        role: "apollo-core-service-c4d-standard-8"
      tolerations:
        - key: key
          operator: "Equal"
          value: "apollo-core-service-c4d-standard-8"
          effect: "NoSchedule"
      containers:
      - name: verify
        image: busybox
        command: ["/bin/sh", "-c"]
        args:
        - |
          echo "========================================="
          echo "DISK VERIFICATION CHECK"
          echo "========================================="
          echo ""
          
          echo "Listing /data contents:"
          ls -la /data/
          echo ""
          
          echo "Disk usage:"
          du -sh /data/*
          echo ""
          
          echo "Searching for blockchain databases:"
          find /data -name "SN_MAIN*" -o -name "batcher" -o -name "class_manager" || echo "No databases found (GOOD!)"
          echo ""
          
          echo "Total disk size:"
          df -h /data
          echo ""
          
          if [ "$(ls -A /data)" ]; then
            echo "❌ WARNING: /data is NOT empty!"
            echo "Contents:"
            ls -la /data/
            exit 1
          else
            echo "✅ SUCCESS: /data is empty!"
            exit 0
          fi
        volumeMounts:
        - name: data
          mountPath: /data
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: dean-hyperdisk-pvc

