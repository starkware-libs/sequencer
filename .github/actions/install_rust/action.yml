name: Bootstrap rust installation
description: Setup rust environment and its components, also caching the build results.

inputs:
  github_token:
    description: "Github token to use for authentication"
    required: false

runs:
  using: "composite"
  steps:
    - name: Mount Namespace cache volume
      uses: namespacelabs/nscloud-cache-action@v1
      with:
        path: /home/runner/.cargo

    - uses: moonrepo/setup-rust@v1
      name: Install Rust toolchain and binaries
      with:
        cache: false
        inherit-toolchain: true
      env:
        GITHUB_TOKEN: ${{ inputs.github_token }}

    - name: Install cargo tools
      shell: bash
      run: ./scripts/install_cargo_tools.sh

    # This installation is _not_ cached, but takes a couple seconds: it's downloading prepackaged binaries.
    - name: Install Anvil
      uses: foundry-rs/foundry-toolchain@v1
      with:
        version: v1.5.1
